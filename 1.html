<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Install</title>
    
    <!-- PWA Í¥ÄÎ†® Î©îÌÉÄÌÉúÍ∑∏ -->
    <link rel="manifest" id="manifest">
    <meta name="theme-color" content="#000000">

    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #installBtn { padding: 10px 20px; font-size: 16px; cursor: pointer; display: none; }
    </style>
</head>
<body>

    <h1>PWA Install Demo</h1>
    <button id="installBtn">Install PWA</button>

    <script>
        // üü¢ Service Worker Îì±Î°ù
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("sw.js").then(() => {
                console.log("Service Worker Îì±Î°ù ÏôÑÎ£å");
            });
        }

        // üü¢ PWA ÏÑ§Ïπò Î≤ÑÌäº Ï≤òÎ¶¨
        let deferredPrompt;
        const installBtn = document.getElementById("installBtn");

        window.addEventListener("beforeinstallprompt", (event) => {
            event.preventDefault();
            deferredPrompt = event;
            installBtn.style.display = "block";
        });

        installBtn.addEventListener("click", () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === "accepted") {
                        console.log("PWA ÏÑ§ÏπòÎê®");
                    }
                    deferredPrompt = null;
                    installBtn.style.display = "none";
                });
            }
        });

        // üü¢ manifest.jsonÏùÑ ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞Ä
        const manifestData = {
            name: "My PWA App",
            short_name: "PWA App",
            start_url: "/",
            display: "standalone",
            background_color: "#ffffff",
            theme_color: "#000000",
            icons: [
                { src: "icon-192.png", sizes: "192x192", type: "image/png" },
                { src: "icon-512.png", sizes: "512x512", type: "image/png" }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifestData)], { type: "application/json" });
        document.getElementById("manifest").setAttribute("href", URL.createObjectURL(manifestBlob));
    </script>

    <!-- üü¢ Service Worker ÏΩîÎìú -->
    <script>
        const swBlob = new Blob([`
            self.addEventListener("install", event => {
                console.log("Service Worker ÏÑ§ÏπòÎê®");
                event.waitUntil(
                    caches.open("pwa-cache").then(cache => {
                        return cache.addAll(["/"]);
                    })
                );
            });

            self.addEventListener("fetch", event => {
                event.respondWith(
                    caches.match(event.request).then(response => {
                        return response || fetch(event.request);
                    })
                );
            });
        `], { type: "application/javascript" });

        const swUrl = URL.createObjectURL(swBlob);
        navigator.serviceWorker.register(swUrl);
    </script>

</body>
</html>
