<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIMA MAP</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9f9f9;
            overflow: hidden; /* í˜ì´ì§€ì—ì„œ ìŠ¤í¬ë¡¤ë°”ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤ */
        }

        #map-wrapper {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: relative;
            background: #f5f5f5;
        }

        #map-container {
            position: absolute;
            transform-origin: 0 0;
            cursor: grab;
            width: 100%;
            height: 100%;
        }

        #map-container:active {
            cursor: grabbing;
        }

        #map-image {
            width: 1200px;
            height: 900px;
            user-select: none;
            object-fit: cover;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
        }

        /* ìƒë‹¨ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 1200px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 9999;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;  /* í•­ëª©ë“¤ì„ ì¤„ ë°”ê¿ˆì´ ê°€ëŠ¥í•˜ê²Œ í•¨ */
            gap: 16px;  /* í•­ëª© ê°„ì˜ ê°„ê²© */
        }

            /* ê²€ìƒ‰ì°½ */
        .search-container {
            left: 50%;
            display: flex;

            gap: 40px; /* íƒ€ì´í‹€ê³¼ ê²€ìƒ‰ì°½ ê°„ ê°„ê²© */
            margin-bottom: 00px; /* ì»¨í…Œì´ë„ˆ ê°„ ê°„ê²© */
        }

        .search-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .search-input {
            flex: 1; /* ì…ë ¥ ì°½ì´ ë‚¨ì€ ê³µê°„ì„ ì°¨ì§€í•˜ë„ë¡ ì„¤ì • */
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .search-results {
            margin-top: 5px;
        }

        /* í•„í„°ë§ ê·¸ë£¹ì„ 1ì¤„ì— ë°°ì¹˜ */
        .filter-group {
            display: flex;
            gap: 16px;
            flex-wrap: nowrap;  /* í•„í„° ê·¸ë£¹ì€ í•œ ì¤„ì— ë°°ì¹˜ */
        }

        #category-filter {
            display: flex;
            flex-wrap: nowrap;  /* í•œ ì¤„ë¡œ ë°°ì¹˜ */
            gap: 16px;
            width: 100%;  /* ì „ì²´ ë„ˆë¹„ ì‚¬ìš© */
            overflow-x: auto;  /* ê°€ë¡œ ìŠ¤í¬ë¡¤ì„ ì¶”ê°€ */
            padding-bottom: 10px;  /* ìŠ¤í¬ë¡¤ë°”ê°€ ë³´ì´ë„ë¡ ì•„ë˜ ì—¬ë°± ì¶”ê°€ */
        }

        #category-filter label {
            box-sizing: border-box;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 14px;
        }

        .filter-select {
            width: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .filter-button {
            padding: 12px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        .filter-button:hover {
            background: #1976D2;
        }

        /* í•€ ë° ì •ë³´ ë°•ìŠ¤ */
        .pin {
            position: absolute;
            width: 30px;
            height: 30px;
            transform: translate(-50%, -100%);
            z-index: 1000;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .pin:hover {
            transform: translate(-50%, -100%) scale(1.1);
        }

        .pin::before {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23E91E63"><path d="M12 0C7.6 0 4 3.6 4 8c0 5.4 8 16 8 16s8-10.6 8-16c0-4.4-3.6-8-8-8zm0 12c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4z"/></svg>') no-repeat center center;
            background-size: contain;
        }

        .pin-info-box {
            position: fixed;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
            z-index: 1001;
            max-width: 300px;
            font-size: 14px;
            line-height: 1.6;
        }

        .pin-info-box strong {
            color: #333;
            display: inline-block;
            width: 80px;
        }

        .pin-info-box a {
            color: #2196F3;
            text-decoration: none;
        }

        .pin-info-box a:hover {
            text-decoration: underline;
        }

        .pin-info-box .close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 18px;
            cursor: pointer;
            color: #666;
            line-height: 1;
        }

        .pin-info-box .close-btn:hover {
            color: #333;
        }

        /* ì¹´í…Œê³ ë¦¬ ìŠ¤í¬ë¡¤ */
        .category-scroll {
            display: flex;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding: 10px 0;
            gap: 10px;
        }

        .category-item {
            flex: 0 0 auto;
            padding: 8px 16px;
            background: #f0f0f0;
            border-radius: 20px;
            white-space: nowrap;
        }

    .mobile-nav {
        display: none;
    }

    /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ìš°ìƒë‹¨ì— ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ */
    .nav-logo {
        display: flex;
        align-items: center;
        position: absolute;
        bottom: 30px;
        right: 50px;
    }

    /* ë¡œê³  ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
    .logo-img {
        width: 140px; /* ì´ë¯¸ì§€ í¬ê¸° ì„¤ì • */
        height: auto;
        -webkit-user-drag: none;
        -khtml-user-drag: none;
        -moz-user-drag: none;
        -o-user-drag: none;
    }

    /* ë¡œê³  í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    .logo-text {
        font-size: 13px; /* í…ìŠ¤íŠ¸ í¬ê¸° */
        font-weight: bold;
        margin-right: 20px; /* ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ ì‚¬ì´ ì—¬ë°± */
        color: #f9f9f9; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
    }

        
    @media (max-width: 768px) {

            /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ìš°ìƒë‹¨ì— ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ */
    .nav-logo {
        display: flex;
        align-items: center;
        position: absolute;
        bottom: 90px;
        right: 10px;
        -webkit-user-drag: none;
        -khtml-user-drag: none;
        -moz-user-drag: none;
        -o-user-drag: none;
    }

    /* ë¡œê³  ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
    .logo-img {
        width: 130px; /* ì´ë¯¸ì§€ í¬ê¸° ì„¤ì • */
        height: auto;
    }

    /* ë¡œê³  í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    .logo-text {
        font-size: 12px; /* í…ìŠ¤íŠ¸ í¬ê¸° */
        font-weight: bold;
        margin-right: 20px; /* ì´ë¯¸ì§€ì™€ í…ìŠ¤íŠ¸ ì‚¬ì´ ì—¬ë°± */
        color: #f9f9f9; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
    }
    .control-panel {
        position: fixed;
        top: 6px;
        left: 50%;
        width: 100%;
        background: white;
        padding: 10px 15px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        background: transparent;
        box-shadow: none;
        padding: 30px;
    }

    /* ëª¨ë°”ì¼ ë„¤ë¹„ê²Œì´ì…˜ */
.mobile-nav {
    display: flex;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    padding: 18px 0;
    justify-content: space-around;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
}

/* ë„¤ë¹„ê²Œì´ì…˜ í•­ëª© ì‚¬ì´ì— êµ¬ë¶„ì„  ì¶”ê°€ */
.mobile-nav a {
    padding: 0px;
    text-align: center;
    flex-grow: 1;
    border-right: 1px solid #ddd; /* í•­ëª© ì‚¬ì´ì— êµ¬ë¶„ì„  */
}

    /* ë§ˆì§€ë§‰ í•­ëª©ì˜ êµ¬ë¶„ì„  ì—†ì• ê¸° */
    .mobile-nav a:last-child {
        border-right: none;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: #666;
        font-size: 15px;
        gap: 4px;
    }

    
    .filter-group {
        display: none; /* í•„í„° ê·¸ë£¹ ìˆ¨ê¹€ */
    }
    
    .bottom-nav {
        display: block; /* ëª¨ë°”ì¼ì—ì„œë§Œ í‘œì‹œ */
    }
    
    #map-wrapper {
        padding-bottom: 10px; /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë†’ì´ë§Œí¼ ì—¬ë°± */
    }
    
    /* ì¹´í…Œê³ ë¦¬ ìŠ¤í¬ë¡¤ í™œì„±í™” */
    #category-filter {
        display: flex;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        padding: 10px 0;
        gap: 10px;
        width: 86%;
        margin: 0 auto;
    }
    
    #category-filter label {
        flex: 0 0 auto;
        padding: 8px 16px;
        background: #f0f0f0;
        border-radius: 20px;
        white-space: nowrap;
    }

    /* ê²€ìƒ‰ì°½ì„ ì¤‘ì•™ì— ë°°ì¹˜ */
    .search-container {
        background: white;
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        width: 85%;
        max-width: 800px; /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
        margin: 0 auto; /* ìë™ìœ¼ë¡œ ì¢Œìš° ì—¬ë°± */
    }
}

    .search-input {
        border: none;
        padding: 8px;
        width: 100%;
        font-size: 16px;
    }

    /* ì¹´í…Œê³ ë¦¬ ìŠ¤íƒ€ì¼ */
    #category-filter {
        display: flex;
        gap: 10px;
        overflow-x: auto;
        padding: 10px 0;
        -webkit-overflow-scrolling: touch;
    }

    #category-filter label {
        background: #e155b5;
        color: white;
        padding: 8px 20px;
        border-radius: 20px;
        white-space: nowrap;
        font-size: 14px;
    }

    /* í•˜ë‹¨ ê±´ë¬¼ ì •ë³´ */
    .bottom-info {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #4267B2;
        color: white;
        padding: 20px;
        border-radius: 15px 15px 0 0;
    }

    .bottom-info div {
        margin: 5px 0;
        font-size: 16px;
    }


    @media (max-width: 480px) {
        /* ì‘ì€ í™”ë©´ì—ì„œ ë¼ë²¨ í¬ê¸° ë° ì…ë ¥ í¬ê¸° ì¡°ì • */
        .search-input {
            font-size: 14px;
            padding: 6px;
        }

        .filter-select {
            font-size: 14px;
            padding: 6px;
        }
    }
    </style>
</head>
<body>
    <div class="control-panel">
        <!-- ê²€ìƒ‰ ì°½ -->
        <div class="search-container">
            <span class="search-title">DIMA MAP</span> <!-- íƒ€ì´í‹€ ì¶”ê°€ -->
            <input type="text" class="search-input" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." id="search-input">
            <div class="search-results" id="search-results"></div>
        </div>

        <!-- í•„í„°ë§ -->
        <div class="filter-group">
            <label for="building-filter">ê±´ë¬¼</label>
            <select id="building-filter" class="filter-select"></select>

            <label for="floor-filter">ì¸µ</label>
            <select id="floor-filter" class="filter-select"></select>
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ í•„í„° -->
        <div id="category-filter">
            <label><input type="checkbox" name="category" value=""> ì „ì²´</label>
            <!-- ë™ì ìœ¼ë¡œ ì¹´í…Œê³ ë¦¬ ë¼ë””ì˜¤ ë²„íŠ¼ ì¶”ê°€ -->
        </div>
    </div>

    <div id="map-wrapper">
        <div id="map-container">
            <img id="map-image" src="map.png" alt="ì§€ë„" draggable="false">
        </div>
    </div>

    <div class="nav-logo">
        <span class="logo-text">ìœ„ì„± ì œê³µ ã…£ êµ­í† ì§€ë¦¬ì •ë³´ì›</span>
        <img src="sub0705_01_Open_Mark_01.jpg" alt="êµ­í† ì§€ë¦¬ì •ë³´ì›" class="logo-img">
    </div>

    <nav class="mobile-nav">
        <a href="https://mytwice.github.io/DIMAMAP/" class="nav-item">
            <span>ğŸ </span>
            <span>í™ˆ</span>
        </a>
        <a href="#" class="nav-item">
            <span>ğŸ”</span>
            <span>ê±´ë¬¼</span>
        </a>
        <a href="#" class="nav-item">
            <span>ğŸ“</span>
            <span>ì•ˆì „ì§€ë„</span>
        </a>
        <a href="https://mytwice.github.io/I-DIMA/" class="nav-item">
            <span>â„¹ï¸</span>
            <span>ì œë³´/ì •ë³´</span>
        </a>
    </nav>
</body>

<script>
// ë³€ìˆ˜ ì„ ì–¸
const mapWrapper = document.getElementById('map-wrapper');
const mapContainer = document.getElementById('map-container');
const searchInput = document.getElementById('search-input');
const searchResults = document.getElementById('search-results');
let pins = [];
let isDragging = false;
let startX, startY;
let currentTranslateX = 0, currentTranslateY = 0, currentScale = 1;
let mode = 'move';
let selectedPin = null;
let activeInfoBox = null;
let lastTouchDistance = 0;
let zoomAnimation;
let initialTouchX, initialTouchY;
let isTouchMoving = false;
let lastTouchTime = 0;
const TOUCH_DELAY = 300; // ë”ë¸”íƒ­ ê°ì§€ë¥¼ ìœ„í•œ ì‹œê°„ ê°„ê²© (ms)

// ë§µ ì„¤ì •
const mapConfig = {
    initialScale: 1.7,
    initialX: -70,
    initialY: 50,
    minScale: 0,
    maxScale: 9,
    zoomSpeed: 1,
    mobile: {
        initialScale: 1.2,
        initialX: -460,
        initialY: -80
    }
};

// í•€ ë°ì´í„°
const pinsData = [
  {
    "id": "1738167046427",
    "x": "621.58",
    "y": "411.58",
    "building": "ë•ì„±ê´€",
    "floor": "4ì¸µ",
    "category": "ì‹¤ìŠµì‹¤",
    "name": "C3ìŠ¤íŠœë””ì˜¤",
    "description": "",
    "address": "",
    "priority": "2ìˆœìœ„"
  },
  {
    "id": "1738167054600",
    "x": "607.37",
    "y": "411.58",
    "building": "ë•ì„±ê´€",
    "floor": "",
    "category": "",
    "name": "ë•ì„±ê´€",
    "description": "",
    "address": "",
    "priority": "1ìˆœìœ„"
  },
  {
    "id": "1738167057999",
    "x": "605.26",
    "y": "439.47",
    "building": "ê¸°ì˜ˆê´€",
    "floor": "",
    "category": "",
    "name": "ê¸°ì˜ˆê´€",
    "description": "",
    "address": "",
    "priority": "1ìˆœìœ„"
  },
  {
    "id": "1738167068064",
    "x": "678.95",
    "y": "750.53",
    "building": "",
    "floor": "ì‹¤ì™¸",
    "category": "ì •ë¥˜ì¥",
    "name": "ì •ë¥˜ì¥",
    "description": "",
    "address": "",
    "priority": "3ìˆœìœ„"
  },
  {
    "id": "1738167211330",
    "x": "604.21",
    "y": "466.84",
    "building": "ì§€ì„±ê´€",
    "floor": "",
    "category": "",
    "name": "ì§€ì„±ê´€",
    "description": "",
    "address": "",
    "priority": "1ìˆœìœ„"
  },
  {
    "id": "1738167333830",
    "x": "589.50",
    "y": "412.50",
    "building": "",
    "floor": "",
    "category": "",
    "name": "",
    "description": "",
    "address": "",
    "priority": "ì—†ìŒ"
  },
  {
    "id": "1738167338043",
    "x": "646.50",
    "y": "443.50",
    "building": "ê¸°ì˜ˆê´€",
    "floor": "",
    "category": "ì‹¤ìŠµì‹¤",
    "name": "ê°œë°©í¸ì§‘ì‹¤",
    "description": "",
    "address": "",
    "priority": "ì—†ìŒ"
  },
  {
    "id": "1738167340599",
    "x": "637.50",
    "y": "470.50",
    "building": "ì§€ì„±ê´€",
    "floor": "",
    "category": "ê³µì—°ì‹œì„¤",
    "name": "ì½˜ì„œíŠ¸í™€",
    "description": "",
    "address": "",
    "priority": "ì—†ìŒ"
  },
  {
    "id": "1738167372951",
    "x": "583.09",
    "y": "463.73",
    "building": "ì§€ì„±ê´€",
    "floor": "5ì¸µ",
    "category": "êµìˆ˜ì—°êµ¬ì‹¤",
    "name": "ì—°êµ¬ì‹¤",
    "description": "",
    "address": "",
    "priority": "ì—†ìŒ"
  },
  {
    "id": "1738167396889",
    "x": "621.09",
    "y": "439.73",
    "building": "ê¸°ì˜ˆê´€",
    "floor": "5ì¸µ",
    "category": "í™”ì¥ì‹¤",
    "name": "í™”ì¥ì‹¤",
    "description": "",
    "address": "",
    "priority": "ì—†ìŒ"
  }
]

// í•„í„° ì˜µì…˜ ì´ˆê¸°í™” í•¨ìˆ˜ (ì¹´í…Œê³ ë¦¬ ë¼ë””ì˜¤ë°•ìŠ¤ë¡œ ë³€ê²½)
function initializeFilterOptions() {
    const buildingFilter = document.getElementById('building-filter');
    const floorFilter = document.getElementById('floor-filter');
    const categoryFilter = document.getElementById('category-filter');

    const buildings = [...new Set(pinsData.map(pin => pin.building))];
    const floors = [...new Set(pinsData.map(pin => pin.floor))];
    const categories = [...new Set(pinsData.map(pin => pin.category))];

    // í•„í„° ì˜µì…˜ ì±„ìš°ê¸°
    function populateFilter(filter, options, type = 'select') {
        if (type === 'checkbox') {
            filter.innerHTML = ''; // ê¸°ì¡´ ì½˜í…ì¸  ì´ˆê¸°í™”
            options.forEach(option => {
                if (option) {
                    const label = document.createElement('label');
                    label.innerHTML = `<input type="checkbox" name="category" value="${option}">${option}</label>`;
                    filter.appendChild(label);
                }
            });
        } else {
            filter.innerHTML = '<option value="">ì „ì²´</option>';
            options.forEach(option => {
                if (option) {
                    filter.innerHTML += `<option value="${option}">${option}</option>`;
                }
            });
        }
    }

    populateFilter(buildingFilter, buildings);
    populateFilter(floorFilter, floors);
    populateFilter(categoryFilter, categories, 'checkbox');
}

// ê²€ìƒ‰ ê¸°ëŠ¥
searchInput.addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase();
    if (searchTerm.length < 1) {
        searchResults.style.display = 'none';
        return;
    }

    const filteredPins = pinsData.filter(pin => 
        pin.name.toLowerCase().includes(searchTerm) ||
        pin.building.toLowerCase().includes(searchTerm) ||
        pin.description.toLowerCase().includes(searchTerm)
    );

    searchResults.innerHTML = '';
    if (filteredPins.length > 0) {
        filteredPins.forEach(pin => {
            const resultItem = document.createElement('div');
            resultItem.className = 'search-result-item';
            resultItem.innerHTML = `
                <div><strong>${pin.name}</strong></div>
                <div>${pin.building} ${pin.floor}</div>
            `;
            resultItem.addEventListener('click', () => {
                const pinObj = pins.find(p => 
                    p.coordinates.x === pin.x && 
                    p.coordinates.y === pin.y
                );
                if (pinObj) {
                    moveToPin(pinObj.pin);
                    showPinInfoBox(pinObj.pin, pin);
                }
                searchResults.style.display = 'none';
                searchInput.value = '';
            });
            searchResults.appendChild(resultItem);
        });
        searchResults.style.display = 'block';
    } else {
        searchResults.style.display = 'none';
    }
});

// updateMapTransform í•¨ìˆ˜ ìˆ˜ì • 
function updateMapTransform() {
    const wrapperWidth = mapWrapper.offsetWidth;
    const wrapperHeight = mapWrapper.offsetHeight;
    const mapWidth = 1200 * currentScale;
    const mapHeight = 900 * currentScale;

    // ë§µì´ wrapperë³´ë‹¤ ì‘ì•„ì§€ì§€ ì•Šë„ë¡ ìµœì†Œ ìŠ¤ì¼€ì¼ ê³„ì‚°
    const minScaleX = wrapperWidth / 1200;
    const minScaleY = wrapperHeight / 900;
    const minScale = Math.max(minScaleX, minScaleY);

    // í˜„ì¬ ìŠ¤ì¼€ì¼ì´ ìµœì†Œ ìŠ¤ì¼€ì¼ë³´ë‹¤ ì‘ì•„ì§€ì§€ ì•Šë„ë¡ ì œí•œ
    if (currentScale < minScale) {
        currentScale = minScale;
    }



    // ê²½ê³„ ì œí•œ ê°•í™”
    const maxTranslateX = 0;
    const maxTranslateY = 0;
    const minTranslateX = wrapperWidth - mapWidth;
    const minTranslateY = wrapperHeight - mapHeight;

    // translate ê°’ ì œí•œ
    currentTranslateX = Math.min(maxTranslateX, Math.max(minTranslateX, currentTranslateX));
    currentTranslateY = Math.min(maxTranslateY, Math.max(minTranslateY, currentTranslateY));

    // transform ì ìš©
    mapContainer.style.transform = 
        `translate(${currentTranslateX}px, ${currentTranslateY}px) scale(${currentScale})`;

    // í•€ ì •ë³´ì°½ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
    if (activeInfoBox && selectedPin) {
        const pinRect = selectedPin.getBoundingClientRect();
        activeInfoBox.style.left = `${pinRect.left}px`;
        activeInfoBox.style.top = `${pinRect.top - 100}px`;
    }
}


function animateScroll(targetX, targetY) {
    const duration = 800; // ì• ë‹ˆë©”ì´ì…˜ ì§€ì† ì‹œê°„ (ms)
    const startX = currentTranslateX;
    const startY = currentTranslateY;
    const deltaX = targetX - startX;
    const deltaY = targetY - startY;
    const startTime = performance.now();

    function scrollStep(currentTime) {
        const progress = Math.min((currentTime - startTime) / duration, 1);
        const easeProgress = 1 - Math.pow(1 - progress, 2); // easeOutQuad

        currentTranslateX = startX + deltaX * easeProgress;
        currentTranslateY = startY + deltaY * easeProgress;

        updateMapTransform();

        if (progress < 1) {
            requestAnimationFrame(scrollStep);
        }
    }

    requestAnimationFrame(scrollStep);
}

// í•€ ìƒì„± í•¨ìˆ˜ ìˆ˜ì •
function createPin(x, y, details = {}) {
    const pin = document.createElement('div');
    pin.className = 'pin';
    pin.style.left = `${x}px`;
    pin.style.top = `${y}px`;

    // í•€ì˜ ìš°ì„ ìˆœìœ„ ì„¤ì •
    pin.dataset.priority = details.priority || 'ë¯¸ì •';
    pin.dataset.building = details.building || 'ë¯¸ì •';

    // í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    const handlePinInteraction = function(e) {
        e.stopPropagation();

        // 1ìˆœìœ„ í•€ì„ í´ë¦­í–ˆì„ ë•Œ ì•ˆë‚´ì°½ì„ ëœ¨ì§€ ì•Šê²Œ ì²˜ë¦¬
        if (details.priority === "1ìˆœìœ„") {
            showPriorityPins(details.building); // ê°™ì€ ê±´ë¬¼ì˜ 2ìˆœìœ„ í•€ì„ í‘œì‹œ
            showExitButton(); // Exit button appears when 2ìˆœìœ„ pins are shown
        } else {
            // 2ìˆœìœ„ í•€ë§Œ ì•ˆë‚´ì°½ì„ í‘œì‹œ
            showPinInfoBox(pin, details);
        }
    };

    // ë°ìŠ¤í¬í†± í´ë¦­ ì´ë²¤íŠ¸
    pin.addEventListener('click', handlePinInteraction);
    
    // ëª¨ë°”ì¼ í„°ì¹˜ ì´ë²¤íŠ¸
    pin.addEventListener('touchstart', function(e) {
        e.stopPropagation();  // ì§€ë„ì˜ í„°ì¹˜ ì´ë²¤íŠ¸ ì¤‘ì§€
        
        // í„°ì¹˜ ì‹œì‘ ì‹œê°„ ì €ì¥
        this.touchStartTime = new Date().getTime();
        this.touchStartX = e.touches[0].clientX;
        this.touchStartY = e.touches[0].clientY;
    });

    pin.addEventListener('touchend', function(e) {
        e.stopPropagation();  // ì§€ë„ì˜ í„°ì¹˜ ì´ë²¤íŠ¸ ì¤‘ì§€
        
        // í„°ì¹˜ ì¢…ë£Œ ì‹œê°„ê³¼ ì´ë™ ê±°ë¦¬ ê³„ì‚°
        const touchEndTime = new Date().getTime();
        const touchTime = touchEndTime - this.touchStartTime;
        const touchEndX = e.changedTouches[0].clientX;
        const touchEndY = e.changedTouches[0].clientY;
        const touchDistance = Math.hypot(
            touchEndX - this.touchStartX,
            touchEndY - this.touchStartY
        );

        // ì§§ì€ í„°ì¹˜(500ms ì´í•˜)ì™€ ì‘ì€ ì´ë™ ê±°ë¦¬(10px ì´í•˜)ì¼ ë•Œë§Œ í•€ ì •ë³´ í‘œì‹œ
        if (touchTime < 500 && touchDistance < 10) {
            handlePinInteraction(e);
        }
    });

    mapContainer.appendChild(pin);
    pins.push({
        pin,
        coordinates: { x, y },
        ...details
    });
}

// 1ìˆœìœ„ í•€ì„ í´ë¦­í–ˆì„ ë•Œ, í•´ë‹¹ ê±´ë¬¼ì— ì†í•˜ëŠ” 2ìˆœìœ„ í•€ ë³´ì´ê¸°
function showPriorityPins(buildingName) {
    // ëª¨ë“  1ìˆœìœ„ í•€ ìˆ¨ê¸°ê¸°
    pins.forEach(pinObj => {
        if (pinObj.pin.dataset.priority === "1ìˆœìœ„") {
            pinObj.pin.style.display = 'none'; // ëª¨ë“  1ìˆœìœ„ í•€ì„ ìˆ¨ê¹€
        }
    });

    // ëª¨ë“  í•€ ì¤‘ì—ì„œ "2ìˆœìœ„"ì´ê³ , ê±´ë¬¼ì´ í•´ë‹¹ ì´ë¦„ì¸ í•€ì„ ë³´ì´ê²Œ í•¨
    pins.forEach(pinObj => {
        if (pinObj.pin.dataset.priority === "2ìˆœìœ„" && pinObj.pin.dataset.building === buildingName) {
            pinObj.pin.style.display = 'block'; // í•´ë‹¹ 2ìˆœìœ„ í•€ì„ ë³´ì´ê²Œ í•¨
        } else if (pinObj.pin.dataset.priority === "2ìˆœìœ„") {
            pinObj.pin.style.display = 'none'; // 2ìˆœìœ„ í•€ ì¤‘ í•´ë‹¹ ê±´ë¬¼ì´ ì•„ë‹Œ ê²ƒì€ ìˆ¨ê¹€
        }
    });
}

// 2ìˆœìœ„ í•€ì´ ë³´ì¼ ë•Œ "ê±´ë¬¼ ë‚˜ê°€ê¸°" ë²„íŠ¼ì„ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
function showExitButton() {
    if (exitButton === null) { // exitButtonì´ ì—†ì„ ë•Œë§Œ ìƒˆë¡œ ìƒì„±
        exitButton = document.createElement('button');
        exitButton.className = 'exit-button';
        exitButton.innerText = 'ê±´ë¬¼ ë‚˜ê°€ê¸°';

// ë²„íŠ¼ ìœ„ì¹˜ë¥¼ ë™ì ìœ¼ë¡œ ì¡°ì •
exitButton.style.position = 'absolute'; // absolute positioning for custom control
exitButton.style.top = '200px'; // Yì¶• ìœ„ì¹˜ë¥¼ 200pxë¡œ ì„¤ì • (í•„ìš”í•œ ë§Œí¼ ì¡°ì • ê°€ëŠ¥)
exitButton.style.left = '90%'; // ê°€ë¡œ ìœ„ì¹˜ ì¡°ì •
exitButton.style.transform = 'translateX(-82%)'; // ê°€ë¡œ ì¤‘ì•™ ì •ë ¬
exitButton.style.background = '#e155b5';
exitButton.style.color = 'white';
exitButton.style.padding = '8px 13px';
exitButton.style.borderRadius = '20px'; // ìˆ˜ì •ëœ ë¶€ë¶„
exitButton.style.whiteSpace = 'nowrap'; // ìˆ˜ì •ëœ ë¶€ë¶„
exitButton.style.fontSize = '14px'; // ìˆ˜ì •ëœ ë¶€ë¶„
    
        exitButton.addEventListener('click', function() {
            hidePriorityPins();
            hideExitButton();
        });

        document.body.appendChild(exitButton);
    } else {
        // ì´ë¯¸ exitButtonì´ í™”ë©´ì— ìˆì„ ê²½ìš° displayë§Œ ë³€ê²½
        exitButton.style.display = 'block';
    }
}


// "ê±´ë¬¼ ë‚˜ê°€ê¸°" ë²„íŠ¼ì„ ìˆ¨ê¸°ëŠ” í•¨ìˆ˜
function hideExitButton() {
    if (exitButton) {
        exitButton.style.display = 'none';
    }
}

// "1ìˆœìœ„"ë§Œ ë³´ì´ë„ë¡ 2ìˆœìœ„ í•€ì„ ìˆ¨ê¸°ëŠ” í•¨ìˆ˜
function hidePriorityPins() {
    pins.forEach(pinObj => {
        if (pinObj.pin.dataset.priority === "2ìˆœìœ„") {
            pinObj.pin.style.display = 'none'; // ëª¨ë“  2ìˆœìœ„ í•€ì„ ìˆ¨ê¹€
        }
    });
    showOnlyFirstPriorityPins(); // 1ìˆœìœ„ í•€ë§Œ ë³´ì´ê²Œ
}

// 1ìˆœìœ„ í•€ë§Œ ë³´ì´ë„ë¡ í•˜ëŠ” í•¨ìˆ˜
function showOnlyFirstPriorityPins() {
    pins.forEach(pinObj => {
        if (pinObj.pin.dataset.priority === "1ìˆœìœ„") {
            pinObj.pin.style.display = 'block'; // 1ìˆœìœ„ í•€ë§Œ ë³´ì´ê²Œ í•¨
        }
    });
}


// í•€ ì •ë³´ì°½ í‘œì‹œ í•¨ìˆ˜
function showPinInfoBox(pin, pinData) {
    if (activeInfoBox) {
        activeInfoBox.remove();
    }

    const pinRect = pin.getBoundingClientRect();
    const infoBox = document.createElement('div');
    infoBox.className = 'pin-info-box';
    
    infoBox.style.left = `${pinRect.left}px`;
    infoBox.style.top = `${pinRect.top - 100}px`;

    const closeBtn = document.createElement('span');
    closeBtn.className = 'close-btn';
    closeBtn.innerHTML = 'Ã—';
    closeBtn.onclick = function(e) {
        e.stopPropagation();
        infoBox.style.display = 'none';
        activeInfoBox = null;
    };
    infoBox.appendChild(closeBtn);

    infoBox.innerHTML += `
        <strong>ì´ë¦„:</strong> ${pinData.name || 'ë¯¸ì •'}<br>
        <strong>ê±´ë¬¼:</strong> ${pinData.building || 'ë¯¸ì •'}<br>
        <strong>ì¸µ:</strong> ${pinData.floor || 'ë¯¸ì •'}<br>
        <strong>ì¹´í…Œê³ ë¦¬:</strong> ${pinData.category || 'ë¯¸ì •'}<br>
        <strong>ì„¤ëª…:</strong> ${pinData.description || 'ë¯¸ì •'}<br>
        <strong>ì£¼ì†Œ:</strong> 
        ${pinData.address ? `<a href="${pinData.address}" target="_blank">${pinData.address}</a>` : 'ë¯¸ì •'}
    `;
    
    document.body.appendChild(infoBox);
    infoBox.style.display = 'block';
    activeInfoBox = infoBox;
    selectedPin = pin;

    // ì •ë³´ì°½ì´ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì¡°ì •
    const infoBoxRect = infoBox.getBoundingClientRect();
    if (infoBoxRect.top < 0) {
        infoBox.style.top = '10px';
    }
    if (infoBoxRect.left < 0) {
        infoBox.style.left = '10px';
    }
    if (infoBoxRect.right > window.innerWidth) {
        infoBox.style.left = `${window.innerWidth - infoBoxRect.width - 10}px`;
    }

        // í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        closeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        infoBox.remove();
        activeInfoBox = null;
        selectedPin = null;
    });

    infoBox.appendChild(closeBtn);
}

// í•„í„°ë§ í•¨ìˆ˜
function filterPins() {
    const buildingFilter = document.getElementById('building-filter').value;
    const floorFilter = document.getElementById('floor-filter').value;
    
    // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ê°’ ê°€ì ¸ì˜¤ê¸°
    const selectedCategories = [...document.querySelectorAll('input[name="category"]:checked')]
        .map(checkbox => checkbox.value);

    pins.forEach(pinObj => {
        const matchesBuilding = !buildingFilter || pinObj.building === buildingFilter;
        const matchesFloor = !floorFilter || pinObj.floor === floorFilter;

        // ì„ íƒëœ ì¹´í…Œê³ ë¦¬ë“¤ ì¤‘ í•˜ë‚˜ë¼ë„ í•´ë‹¹ë˜ë©´ í•´ë‹¹ í•€ì„ í‘œì‹œ
        const matchesCategory = selectedCategories.length === 0 || selectedCategories.includes(pinObj.category);

        // ëª¨ë“  ì¡°ê±´ì´ ë§ìœ¼ë©´ í•€ì„ í‘œì‹œ, ì•„ë‹ˆë©´ ìˆ¨ê¹€
        if (matchesBuilding && matchesFloor && matchesCategory) {
            pinObj.pin.style.display = 'block';
        } else {
            pinObj.pin.style.display = 'none';
        }

    });
}

// í•„í„°ë§ í•¨ìˆ˜ ìˆ˜ì • - ìµœì´ˆ ì‹¤í–‰ì‹œ 1ìˆœìœ„ í•€ë§Œ ë³´ì´ë„ë¡
function filterPins2() {
    const priorityFilter = "1ìˆœìœ„";
    
    pins.forEach(pinObj => {
        // 1ìˆœìœ„ì´ê±°ë‚˜ 3ìˆœìœ„ì¸ í•€ë§Œ í‘œì‹œ
        const matchesPriority = pinObj.priority === priorityFilter || pinObj.priority === "3ìˆœìœ„";
        
        if (matchesPriority) {
            pinObj.pin.style.display = 'block';
        } else {
            pinObj.pin.style.display = 'none';
        }
    });
}

// íŠ¹ì • í•€ìœ¼ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
function moveToPin(pin) {
    const pinRect = pin.getBoundingClientRect();
    const wrapperRect = mapWrapper.getBoundingClientRect();
    
    const targetX = -(pin.offsetLeft * currentScale - (wrapperRect.width / 2));
    const targetY = -(pin.offsetTop * currentScale - (wrapperRect.height / 2));
    
    mapContainer.style.transition = 'transform 0.5s ease-out';
    currentTranslateX = targetX;
    currentTranslateY = targetY;
    updateMapTransform();
    
    setTimeout(() => {
        mapContainer.style.transition = '';
    }, 500);
}

// í„°ì¹˜ ì´ë²¤íŠ¸ ê´€ë ¨ ë³€ìˆ˜
let initialTouchDistance = 0;
let lastTouchX = 0;
let lastTouchY = 0;
let isTouching = false;
let lastTapTime = 0;
let initialPinchScale = 1;
let pinchStartX = 0;  // í•€ì¹˜ ì‹œì‘ X ì¢Œí‘œ
let pinchStartY = 0;  // í•€ì¹˜ ì‹œì‘ Y ì¢Œí‘œ
let exitButton = null;

// í„°ì¹˜ ì‹œì‘ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
mapContainer.addEventListener('touchstart', function(e) {
    e.preventDefault();
    isTouching = true;
    
    if (e.touches.length === 1) {
        // ì‹±ê¸€ í„°ì¹˜ (ì´ë™)
        const touch = e.touches[0];
        lastTouchX = touch.clientX;
        lastTouchY = touch.clientY;
        
        // ë”ë¸” íƒ­ í™•ì¸
        const currentTime = new Date().getTime();
        const tapLength = currentTime - lastTapTime;
        
        if (tapLength < 300 && tapLength > 0) {
            // ë”ë¸” íƒ­ í™•ëŒ€
            const touch = e.touches[0];
            const targetScale = currentScale === mapConfig.maxScale ? 
                mapConfig.minScale : Math.min(currentScale * 2, mapConfig.maxScale);
            
            smoothZoom(targetScale, touch.clientX, touch.clientY);
        }
        
        lastTapTime = currentTime;
        
    } else if (e.touches.length === 2) {
        // ë©€í‹° í„°ì¹˜ (í•€ì¹˜ ì¤Œ)
        const touch1 = e.touches[0];
        const touch2 = e.touches[1];
        
        // í•€ì¹˜ ì‹œì‘ ì§€ì  ì €ì¥ (ë‘ ì†ê°€ë½ì˜ ì¤‘ì‹¬ì )
        pinchStartX = (touch1.clientX + touch2.clientX) / 2;
        pinchStartY = (touch1.clientY + touch2.clientY) / 2;
        
        initialTouchDistance = Math.hypot(
            touch2.clientX - touch1.clientX,
            touch2.clientY - touch1.clientY
        );
        initialPinchScale = currentScale;
    }
});

// í„°ì¹˜ ì´ë™ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
mapContainer.addEventListener('touchmove', function(e) {
    e.preventDefault();
    
    if (!isTouching) return;
    
    if (e.touches.length === 1) {
        // ì‹±ê¸€ í„°ì¹˜ (ì´ë™)
        const touch = e.touches[0];
        const deltaX = touch.clientX - lastTouchX;
        const deltaY = touch.clientY - lastTouchY;
        
        currentTranslateX += deltaX;
        currentTranslateY += deltaY;
        
        lastTouchX = touch.clientX;
        lastTouchY = touch.clientY;
        
        updateMapTransform();
        
    } else if (e.touches.length === 2) {
        // ë©€í‹° í„°ì¹˜ (í•€ì¹˜ ì¤Œ)
        const touch1 = e.touches[0];
        const touch2 = e.touches[1];
        
        // í˜„ì¬ í„°ì¹˜ í¬ì¸íŠ¸ ê°„ì˜ ê±°ë¦¬ ê³„ì‚°
        const currentTouchDistance = Math.hypot(
            touch2.clientX - touch1.clientX,
            touch2.clientY - touch1.clientY
        );
        
        // ìŠ¤ì¼€ì¼ ê³„ì‚°
        const scaleFactor = currentTouchDistance / initialTouchDistance;
        const targetScale = Math.min(
            Math.max(
                mapConfig.minScale,
                initialPinchScale * scaleFactor
            ),
            mapConfig.maxScale
        );
        
        // í•€ì¹˜ ì‹œì‘ ì§€ì ì„ ê¸°ì¤€ìœ¼ë¡œ í™•ëŒ€/ì¶•ì†Œ
        const rect = mapWrapper.getBoundingClientRect();
        const mouseX = pinchStartX - rect.left;
        const mouseY = pinchStartY - rect.top;
        
        // ë§µ ìƒì˜ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ê³„ì‚°
        const mapX = (mouseX - currentTranslateX) / currentScale;
        const mapY = (mouseY - currentTranslateY) / currentScale;
        
        // ì¦‰ì‹œ í™•ëŒ€/ì¶•ì†Œ ì ìš©
        currentScale = targetScale;
        
        // í•€ì¹˜ ì‹œì‘ ì§€ì ì„ ê¸°ì¤€ìœ¼ë¡œ ìƒˆë¡œìš´ translate ê°’ ê³„ì‚°
        currentTranslateX = mouseX - (mapX * currentScale);
        currentTranslateY = mouseY - (mapY * currentScale);
        
        updateMapTransform();
    }
});

// í„°ì¹˜ ì¢…ë£Œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
mapContainer.addEventListener('touchend', function(e) {
    isTouching = false;
    initialTouchDistance = 0;
    initialPinchScale = currentScale;
    pinchStartX = 0;
    pinchStartY = 0;
    
    // ë°”ìš´ìŠ¤ íš¨ê³¼ ì ìš©
    const wrapperWidth = mapWrapper.offsetWidth;
    const wrapperHeight = mapWrapper.offsetHeight;
    const mapWidth = 1200 * currentScale;
    const mapHeight = 900 * currentScale;
    
    const minX = Math.min(0, wrapperWidth - mapWidth);
    const minY = Math.min(0, wrapperHeight - mapHeight);
    
    if (currentTranslateX < minX || currentTranslateX > 0 ||
        currentTranslateY < minY || currentTranslateY > 0) {
        
        mapContainer.style.transition = 'transform 0.3s ease-out';
        currentTranslateX = Math.max(minX, Math.min(0, currentTranslateX));
        currentTranslateY = Math.max(minY, Math.min(0, currentTranslateY));
        updateMapTransform();
        
        setTimeout(() => {
            mapContainer.style.transition = '';
        }, 300);
    }
});

// í„°ì¹˜ ì·¨ì†Œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
mapContainer.addEventListener('touchcancel', function() {
    isTouching = false;
    initialTouchDistance = 0;
    initialPinchScale = currentScale;
    pinchStartX = 0;
    pinchStartY = 0;
});

// ë¶€ë“œëŸ¬ìš´ ì¤Œ í•¨ìˆ˜

function smoothZoom(targetScale, mouseX, mouseY) {
    const startScale = currentScale;
    const scaleDiff = targetScale - startScale;
    const duration = 300;
    
    if (zoomAnimation) {
        cancelAnimationFrame(zoomAnimation);
    }

    // í˜„ì¬ ë·°í¬íŠ¸ ìƒì˜ ë§ˆìš°ìŠ¤ ìœ„ì¹˜
    const viewportX = mouseX;
    const viewportY = mouseY;

    // í˜„ì¬ ë§µ ìƒì˜ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ê³„ì‚°
    const mapX = (viewportX - currentTranslateX) / currentScale;
    const mapY = (viewportY - currentTranslateY) / currentScale;

    const startTime = performance.now();
    
    function animate(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // easeOutQuad ì´ì§• í•¨ìˆ˜ ì‚¬ìš©
        const easeProgress = 1 - (1 - progress) * (1 - progress);
        const newScale = startScale + (scaleDiff * easeProgress);
        
        // ìƒˆë¡œìš´ translate ê°’ ê³„ì‚°
        // ë§ˆìš°ìŠ¤ ìœ„ì¹˜ëŠ” ê³ ì •ëœ ì±„ë¡œ í™•ëŒ€/ì¶•ì†Œë˜ì–´ì•¼ í•¨
        const newTranslateX = viewportX - (mapX * newScale);
        const newTranslateY = viewportY - (mapY * newScale);

        // ê²½ê³„ í™•ì¸
        const mapWidth = 1200 * newScale;
        const mapHeight = 900 * newScale;
        const wrapperWidth = mapWrapper.offsetWidth;
        const wrapperHeight = mapWrapper.offsetHeight;

        // ë§µì´ í™”ë©´ ë°–ìœ¼ë¡œ ë„ˆë¬´ ë§ì´ ë‚˜ê°€ì§€ ì•Šë„ë¡ ì œí•œ
        const minX = Math.min(0, wrapperWidth - mapWidth);
        const minY = Math.min(0, wrapperHeight - mapHeight);

        currentScale = newScale;
        currentTranslateX = Math.max(minX, Math.min(0, newTranslateX));
        currentTranslateY = Math.max(minY, Math.min(0, newTranslateY));
        
        updateMapTransform();
        
        if (progress < 1) {
            zoomAnimation = requestAnimationFrame(animate);
        }
    }
    
    zoomAnimation = requestAnimationFrame(animate);
}

// ë§ˆìš°ìŠ¤ ë‹¤ìš´ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
mapContainer.addEventListener('mousedown', (e) => {
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    mapContainer.style.cursor = 'grabbing';
});

// ë§ˆìš°ìŠ¤ ì´ë™ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì—…ë°ì´íŠ¸
document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    e.preventDefault();
    const deltaX = e.clientX - startX;
    const deltaY = e.clientY - startY;
    
    currentTranslateX += deltaX;
    currentTranslateY += deltaY;
    
    startX = e.clientX;
    startY = e.clientY;
    
    updateMapTransform();
});

document.addEventListener('mouseup', () => {
    isDragging = false;
    mapContainer.style.cursor = 'grab';
});

// Xí‚¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.addEventListener('keydown', function(e) {
    if (e.key === 'x' || e.key === 'X') {
        if (activeInfoBox) {
            activeInfoBox.style.display = 'none';
            activeInfoBox = null;
        }
        if (searchResults.style.display === 'block') {
            searchResults.style.display = 'none';
            searchInput.value = '';
        }
    }
});

// wheel ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìˆ˜ì •
mapWrapper.addEventListener('wheel', function(e) {
    e.preventDefault();
    
    const rect = mapWrapper.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    // í˜„ì¬ ë§µì˜ í¬ê¸° ê³„ì‚°
    const wrapperWidth = mapWrapper.offsetWidth;
    const wrapperHeight = mapWrapper.offsetHeight;
    const minScaleX = wrapperWidth / 1200;
    const minScaleY = wrapperHeight / 900;
    const minScale = Math.max(minScaleX, minScaleY);

    const delta = -e.deltaY / Math.abs(e.deltaY); // ë°©í–¥ë§Œ ì¶”ì¶œ (+1 ë˜ëŠ” -1)
    
    // ì¶•ì†Œí•˜ë ¤ê³  í•  ë•Œ (delta < 0) ìµœì†Œ ìŠ¤ì¼€ì¼ì— ë„ë‹¬í–ˆë‹¤ë©´ ë” ì´ìƒ ì¶•ì†Œí•˜ì§€ ì•ŠìŒ
    if (delta < 0 && currentScale <= minScale) {
        return;
    }
    
    const zoomFactor = 0.6; // ì¤Œ ì†ë„ ì¡°ì ˆ (ê°’ì´ ì‘ì„ìˆ˜ë¡ ë¶€ë“œëŸ¬ì›€)
    const targetScale = Math.min(
        Math.max(
            minScale,
            currentScale * (1 + delta * zoomFactor)
        ),
        mapConfig.maxScale
    );
    
    // í˜„ì¬ ìŠ¤ì¼€ì¼ê³¼ ëª©í‘œ ìŠ¤ì¼€ì¼ì´ ì¶©ë¶„íˆ ë‹¤ë¥¸ ê²½ìš°ì—ë§Œ ì¤Œ ì‹¤í–‰
    if (Math.abs(targetScale - currentScale) > 0.01) {
        smoothZoom(targetScale, mouseX, mouseY);
    }
});

// í´ë¦­ ì´ë²¤íŠ¸ë¡œ ì •ë³´ì°½ê³¼ ê²€ìƒ‰ê²°ê³¼ ë‹«ê¸°
// mapWrapper.addEventListener('click', function() {
//     if (activeInfoBox) {
//         activeInfoBox.style.display = 'none';
//         activeInfoBox = null;
//     }
//     searchResults.style.display = 'none';
//     searchInput.value = '';
// });

// ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸
window.addEventListener('resize', function() {
    updateMapTransform();
    if (activeInfoBox && selectedPin) {
        const pinRect = selectedPin.getBoundingClientRect();
        activeInfoBox.style.left = `${pinRect.left}px`;
        activeInfoBox.style.top = `${pinRect.top - 100}px`;
    }
});

// ì•± ì´ˆê¸°í™”
function initializeMap() {
    // ëª¨ë°”ì¼ ì—¬ë¶€ í™•ì¸
    const isMobile = window.innerWidth <= 768;
    
    // ëª¨ë°”ì¼/ë°ìŠ¤í¬í†±ì— ë”°ë¥¸ ì´ˆê¸° ì„¤ì • ì ìš©
    currentScale = isMobile ? mapConfig.mobile.initialScale : mapConfig.initialScale;
    
    const wrapperWidth = mapWrapper.offsetWidth;
    const wrapperHeight = mapWrapper.offsetHeight;
    const mapWidth = 1200 * currentScale;
    const mapHeight = 900 * currentScale;
    
    if (isMobile) {
        currentTranslateX = mapConfig.mobile.initialX;
        currentTranslateY = mapConfig.mobile.initialY;
    } else {
        if (mapConfig.initialX === 0 && mapConfig.initialY === 0) {
            currentTranslateX = (wrapperWidth - mapWidth) / 2;
            currentTranslateY = (wrapperHeight - mapHeight) / 2;
        } else {
            currentTranslateX = mapConfig.initialX;
            currentTranslateY = mapConfig.initialY;
        }
    }
    
    updateMapTransform();
}

// í•„í„° ì„¤ì •
function setupFilters() {
    const filters = ['building-filter', 'floor-filter', 'category-filter'];
    filters.forEach(filterId => {
        document.getElementById(filterId).addEventListener('change', filterPins);
    });
}

// DOMì´ ë¡œë“œë˜ë©´ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', function() {
    initializeMap();
    initializeFilterOptions();
    setupFilters();
    
    // ëª¨ë“  í•€ ìƒì„±
    pinsData.forEach(pinData => createPin(pinData.x, pinData.y, pinData));
    
    // ìµœì´ˆ ì‹¤í–‰ ì‹œ 1ìˆœìœ„ í•€ë§Œ í‘œì‹œ
    filterPins2();
    
    // ë¶ˆí•„ìš”í•œ í•„í„° ì ìš© ë²„íŠ¼ ì œê±°
    const applyButton = document.getElementById('apply-filters');
    if (applyButton) {
        applyButton.remove();
    }
});

document.addEventListener('contextmenu', function(event) {
    event.preventDefault();  // ìš°í´ë¦­ ë°©ì§€
});
    </script>
</body>
</html>
